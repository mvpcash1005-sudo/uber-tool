<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Uber å…¨èƒ½é§•é§›æˆ°æƒ…å®¤ Pro</title>
    <style>
        /* --- å…¨å±€è¨­å®š (æš—é»‘é§•é§›æ¨¡å¼) --- */
        body { background-color: #000; color: #fff; font-family: -apple-system, BlinkMacSystemFont, Roboto, sans-serif; margin: 0; padding: 0; padding-bottom: 80px; }
        h2 { margin: 0; padding: 15px; text-align: center; background: #111; color: #00ff99; border-bottom: 1px solid #333; font-size: 18px; }
        
        /* --- åº•éƒ¨å°èˆªåˆ— --- */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: #1a1a1a; display: flex; border-top: 1px solid #333; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #666; font-size: 12px; cursor: pointer; }
        .nav-item.active { color: #00ff99; background: #222; }
        .nav-icon { font-size: 20px; margin-bottom: 3px; }

        /* --- åˆ†é å…§å®¹å®¹å™¨ --- */
        .tab-content { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- é€šç”¨å…ƒä»¶æ¨£å¼ --- */
        input, select { width: 100%; padding: 12px; background: #222; border: 1px solid #444; color: #fff; border-radius: 8px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        label { color: #aaa; font-size: 13px; margin-bottom: 4px; display: block; margin-top: 5px; }
        
        .btn-green { background: #00c853; color: white; }
        .btn-blue { background: #2979ff; color: white; }
        .btn-gps { width: 50px; background: #ff9800; color: white; margin-top: 0; }

        /* éš±è—å€å¡Š (ç”¨æ–¼è¡Œæ/å¯µç‰©ç´°ç¯€) */
        .hidden-section { display: none; background: #2a2a2a; padding: 10px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #ff9800; }
        .warning-text { color: #ff5252; font-size: 12px; margin-top: 5px; }
        
        /* çµé‡‘é›·é”å¡ç‰‡ */
        .card { background: #1a1a1a; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #444; position: relative; }
        .card.hot { border-left-color: #ff3d00; } 
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .card-title { font-size: 18px; font-weight: bold; }
        .badge { padding: 3px 6px; border-radius: 4px; font-size: 12px; margin-left: 5px; }
        .badge-price { background: #00c853; color: #fff; }
        .badge-dist { background: #2979ff; color: #fff; }
        .nav-link { display: block; text-align: center; background: #333; padding: 10px; border-radius: 6px; margin-top: 10px; text-decoration: none; color: white; font-weight: bold; }

        /* ä¼°åƒ¹çµæœå€ */
        .price-display { text-align: center; margin-top: 20px; padding: 20px; background: #1a1a1a; border-radius: 12px; border: 1px solid #333; }
        .big-price { font-size: 40px; color: #00ff99; font-weight: bold; margin: 10px 0; }
        .status-tag { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 13px; margin-bottom: 10px; }
        .status-rush { background: #3e1a1a; color: #ff5252; border: 1px solid #ff5252; }
        .status-normal { background: #1a2f3e; color: #40c4ff; border: 1px solid #40c4ff; }
        .status-night { background: #1a3e1a; color: #69f0ae; border: 1px solid #69f0ae; }
        
        /* LINE æŒ‰éˆ•ç¾¤çµ„ */
        .line-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-add-friend { background: #333; color: #ccc; font-size: 14px; flex: 1; padding: 10px; border-radius: 6px; text-decoration: none; display: flex; align-items: center; justify-content: center; border: 1px solid #555; }
        .btn-send-quote { background: #06c755; color: white; font-size: 16px; flex: 2; padding: 10px; border-radius: 6px; text-decoration: none; font-weight: bold; display: flex; align-items: center; justify-content: center; }

        /* æˆ°ç•¥ç­†è¨˜å€ */
        .strategy-box { background: #222; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .strategy-title { color: #ffcc00; font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; }
        .strategy-text { color: #ccc; font-size: 14px; line-height: 1.5; }
    </style>
</head>
<body>

    <h2 id="pageTitle">é›·é”åµæ¸¬ä¸­...</h2>

    <div id="tab-radar" class="tab-content active">
        <div style="display: flex; gap: 10px;">
            <input type="text" id="radarInput" placeholder="è¼¸å…¥ç›®å‰ä½ç½®...">
            <button class="btn-gps" onclick="useGPS()">ğŸ“¡</button>
        </div>
        <select id="radarTimeSelect" onchange="findHotspots()">
            </select>
        <button class="btn-green" onclick="findHotspots()">ğŸ” æƒæç†±é»</button>
        <button onclick="toggleAddPanel()" style="background:#333; color:#aaa; font-size:14px; padding:8px;">â• æ–°å¢ç§æˆ¿é»</button>
        
        <div id="addPanel" style="display:none; background:#222; padding:10px; margin-top:10px; border-radius:8px;">
            <input type="text" id="newName" placeholder="åç¨± (ä¾‹: å…§ç§‘)">
            <input type="number" id="newPrice" placeholder="é‡‘é¡ (ä¾‹: 500)">
            <input type="text" id="newNote" placeholder="å‚™è¨»">
            <div style="color:#888; font-size:12px; margin-bottom:5px;">ğŸ‘‡ é¸æ“‡ç†±é–€æ™‚æ®µ (0-23)</div>
            <input type="text" id="newHours" placeholder="ä¾‹: 17,18,19 (ç”¨é€—è™Ÿéš”é–‹)">
            <button class="btn-blue" onclick="addSpot()">ğŸ’¾ å„²å­˜</button>
        </div>

        <div id="radarResults" style="margin-top:15px;"></div>
    </div>

    <div id="tab-calc" class="tab-content">
        <div id="trafficStatus" class="status-tag status-normal" style="width:100%; text-align:center; box-sizing:border-box;">åµæ¸¬æ™‚æ®µä¸­...</div>
        
        <label>ğŸ“ ä¸Šè»Šåœ°é»</label>
        <input type="text" id="startAddr" placeholder="è«‹è¼¸å…¥ä¸Šè»Šåœ°å€">
        
        <label>ğŸ ä¸‹è»Šåœ°é»</label>
        <input type="text" id="endAddr" placeholder="è«‹è¼¸å…¥ä¸‹è»Šåœ°å€">

        <label>ğŸ“… é å®šç”¨è»Šæ™‚é–“</label>
        <input type="datetime-local" id="bookingTime">

        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>ğŸ‘¥ ä¹˜å®¢äººæ•¸</label>
                <select id="passengerCount">
                    <option value="1">1äºº</option>
                    <option value="2">2äºº</option>
                    <option value="3">3äºº</option>
                    <option value="4">4äºº</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>ğŸ§³ æ˜¯å¦æœ‰è¡Œæ</label>
                <select id="hasLuggage" onchange="toggleLuggage()">
                    <option value="no">ç„¡</option>
                    <option value="yes">æœ‰</option>
                </select>
            </div>
        </div>

        <div id="luggageSection" class="hidden-section">
            <label style="color:#fff; margin-top:0;">ğŸ’ æœ‰å¹¾å€‹è¡Œæç®±ï¼Ÿ</label>
            <input type="number" id="luggageCount" placeholder="è«‹è¼¸å…¥æ•¸é‡ (ä¾‹: 2)" style="margin-bottom:0;">
        </div>

        <label>ğŸ¶ æ˜¯å¦æœ‰å¯µç‰©</label>
        <select id="hasPet" onchange="togglePet()">
            <option value="no">ç„¡</option>
            <option value="yes">æœ‰</option>
        </select>

        <div id="petSection" class="hidden-section" style="border-left-color: #ff5252;">
            <div style="font-weight:bold; color:#fff;">âš ï¸ å¯µç‰©ä¹˜è»Šè¦å®šï¼š</div>
            <div class="warning-text">â€¢ å¯µç‰©å¿…é ˆè£ç± æ‰è¼‰<br>â€¢ æ•ä¸æ­è¼‰å¤§å‹çŠ¬</div>
        </div>
        <button class="btn-blue" onclick="calculateFare()">ğŸ’° ç”¢ç”Ÿå ±åƒ¹å–®</button>

        <div id="calcResult" class="price-display" style="display:none;">
            <div style="color:#aaa; font-size:12px;">é ä¼°è»Šè³‡</div>
            <div class="big-price" id="displayPrice">$0</div>
            
            <div style="background:#222; padding:10px; border-radius:8px; margin-top:10px; text-align:left; font-size:13px; color:#ddd; line-height:1.6;">
                ğŸ“ é‡Œç¨‹ï¼š<span id="displayDist">0</span> km<br>
                â±ï¸ æ™‚é–“ï¼š<span id="displayTime">0</span> åˆ†<br>
                ğŸ‘¥ ä¹˜å®¢ï¼š<span id="resPax">1</span>äºº<br>
                ğŸ§³ è¡Œæï¼š<span id="resLug">ç„¡</span><br>
                ğŸ¶ å¯µç‰©ï¼š<span id="resPet">ç„¡</span><br>
                âš ï¸ <b>æ³¨æ„äº‹é …ï¼šè«‹å…ˆåŒ¯æ¬¾</b>
            </div>
            
            <div style="margin-top:20px; text-align:center; color:#888; font-size:12px; margin-bottom:5px;">ğŸ‘‡ å‚³é€çµ¦å®¢äºº ğŸ‘‡</div>
            <div class="line-actions">
                <a href="#" id="addFriendLink" target="_blank" class="btn-add-friend">1. åŠ å¥½å‹</a>
                <a href="#" id="lineLink" class="btn-send-quote" target="_blank">2. ç™¼é€å ±åƒ¹å–®</a>
            </div>
            <div style="font-size:11px; color:#666; margin-top:5px; text-align:center;">(é»æ“Šç™¼é€å¾Œï¼Œè«‹åœ¨æ¸…å–®ä¸­é»é¸æˆ‘)</div>
        </div>
    </div>

    <div id="tab-strategy" class="tab-content">
        <div class="strategy-box">
            <div class="strategy-title">ğŸ›‘ åœææ³•å‰‡</div>
            <div class="strategy-text">æ¥äºº>8åˆ†é˜æ‹’æ¥ï¼Œé™¤éåŠ æˆ>1.5xã€‚</div>
        </div>
        <div class="strategy-box">
            <div class="strategy-title">âš–ï¸ é»ƒé‡‘æ¯”ä¾‹ (1:2)</div>
            <div class="strategy-text">æ¥äºº5åˆ†é˜ï¼Œè¡Œç¨‹è‡³å°‘è¦10åˆ†é˜ã€‚</div>
        </div>
        <div class="strategy-box">
            <div class="strategy-title">ğŸ—ºï¸ åœ°å½¢æˆ°è¡“</div>
            <div class="strategy-text">
                <b>07-09ï¼š</b> å¾…æ–°åŒ—æ¥é€²åŸã€‚<br>
                <b>17-19ï¼š</b> å¾…åŒ—å¸‚æ¥å›ç¨‹ã€‚<br>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('radar')">
            <div class="nav-icon">ğŸ“¡</div><div>é›·é”</div>
        </div>
        <div class="nav-item" onclick="switchTab('calc')">
            <div class="nav-icon">ğŸ–©</div><div>ä¼°åƒ¹</div>
        </div>
        <div class="nav-item" onclick="switchTab('strategy')">
            <div class="nav-icon">ğŸ“</div><div>ç­†è¨˜</div>
        </div>
    </div>

    <script>
        // ================= å…¨å±€è¨­å®š =================
        const MY_LINE_ID = "love_ice_boy"; // ä½ çš„ ID

        // è³‡æ–™åº«åˆå§‹åŒ–
        const defaultSpots = [
            { name: "ä¿¡ç¾© ATT", lat: 25.0355, lon: 121.5663, price: 550, hours: [22,23,0,1,2,3], note: "å¤œåº—å–®" },
            { name: "å…§ç§‘ç‘å…‰", lat: 25.0805, lon: 121.5721, price: 500, hours: [17,18,19], note: "ä¸‹ç­æ½®" },
            { name: "æ¿æ©‹è»Šç«™", lat: 25.0139, lon: 121.4640, price: 450, hours: [7,8,9,17,18], note: "é«˜éµ/é€šå‹¤" }
        ];
        let myHotspots = JSON.parse(localStorage.getItem('uberDriverData')) || defaultSpots;
        let currentLat, currentLon;

        // ================= ä»‹é¢é‚è¼¯ =================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            const navIndex = tabName === 'radar' ? 0 : tabName === 'calc' ? 1 : 2;
            document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
            const titles = { 'radar': 'çµé‡‘é›·é” v2.0', 'calc': 'å¸æ©Ÿå ±åƒ¹å–®ç”Ÿæˆå™¨', 'strategy': 'é§•é§›æˆ°ç•¥ç­†è¨˜' };
            document.getElementById('pageTitle').innerText = titles[tabName];
            if(tabName === 'calc') updateTrafficStatus();
        }

        // è¡Œæé¸é …åˆ‡æ›
        function toggleLuggage() {
            const show = document.getElementById('hasLuggage').value === 'yes';
            document.getElementById('luggageSection').style.display = show ? 'block' : 'none';
        }

        // å¯µç‰©é¸é …åˆ‡æ›
        function togglePet() {
            const show = document.getElementById('hasPet').value === 'yes';
            document.getElementById('petSection').style.display = show ? 'block' : 'none';
        }

        // ================= ä¼°åƒ¹è¨ˆç®—æ©Ÿé‚è¼¯ (æ ¸å¿ƒä¿®æ”¹) =================
        function updateTrafficStatus() {
            const now = new Date();
            const h = now.getHours();
            const d = now.getDay();
            const el = document.getElementById('trafficStatus');
            if(h >= 23 || h < 6) {
                el.className = "status-tag status-night";
                el.innerText = "ğŸŒ™ æ·±å¤œæ™‚æ®µ (è²»ç‡ä¿‚æ•¸ 0.1)";
                return 0.1;
            } else if ((d>=1 && d<=5) && ((h>=7 && h<9) || (h>=17 && h<19))) {
                el.className = "status-tag status-rush";
                el.innerText = "ğŸ”¥ å°–å³°æ™‚æ®µ (è²»ç‡ä¿‚æ•¸ 0.5)";
                return 0.5;
            } else {
                el.className = "status-tag status-normal";
                el.innerText = "â˜ï¸ ä¸€èˆ¬æ™‚æ®µ (è²»ç‡ä¿‚æ•¸ 0.3)";
                return 0.3;
            }
        }

        async function calculateFare() {
            const start = document.getElementById('startAddr').value;
            const end = document.getElementById('endAddr').value;
            const timeVal = document.getElementById('bookingTime').value;
            const pax = document.getElementById('passengerCount').value;
            const hasLug = document.getElementById('hasLuggage').value === 'yes';
            const lugCount = document.getElementById('luggageCount').value;
            const hasPet = document.getElementById('hasPet').value === 'yes';

            if(!start || !end) return alert("è«‹è¼¸å…¥ä¸Šè»Šå’Œä¸‹è»Šåœ°é»");

            try {
                // 1. æŠ“åº§æ¨™èˆ‡è·é›¢
                const getC = async (addr) => (await (await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${addr}&limit=1`)).json())[0];
                const p1 = await getC(start);
                const p2 = await getC(end);
                
                const r = await (await fetch(`https://router.project-osrm.org/route/v1/driving/${p1.lon},${p1.lat};${p2.lon},${p2.lat}?overview=false`)).json();
                const route = r.routes[0];
                const km = (route.distance / 1000).toFixed(1);
                const mins = Math.ceil(route.duration / 60);
                const factor = updateTrafficStatus();
                
                // 2. è¨ˆç®—åƒ¹æ ¼
                let fare = 85;
                if(km > 1.25) fare += Math.ceil((km - 1.25) / 0.2) * 5;
                fare += Math.ceil(mins * factor) * 5;

                // 3. æº–å‚™é¡¯ç¤ºæ–‡å­—
                const bookingTimeStr = timeVal ? timeVal.replace('T', ' ') : 'ç¾å ´å«è»Š';
                const lugText = hasLug ? `æœ‰ (${lugCount}å€‹)` : 'ç„¡';
                const petText = hasPet ? 'æœ‰ (âš ï¸éœ€è£ç± /æ‹’è¼‰å¤§çŠ¬)' : 'ç„¡';

                // 4. æ›´æ–°ç•«é¢
                document.getElementById('calcResult').style.display = 'block';
                document.getElementById('displayPrice').innerText = `$${fare}`;
                document.getElementById('displayDist').innerText = km;
                document.getElementById('displayTime').innerText = mins;
                document.getElementById('resPax').innerText = pax;
                document.getElementById('resLug').innerText = lugText;
                document.getElementById('resPet').innerText = petText;
                
                if(hasPet) document.getElementById('resPet').style.color = '#ff5252';
                else document.getElementById('resPet').style.color = '#ddd';

                // 5. è¨­å®š LINE è¨Šæ¯å…§å®¹
                const lineMsg = `å¸æ©Ÿå ±åƒ¹å–®ï¼š
${start} â¡ï¸ ${end}
ğŸ“… æ™‚é–“ï¼š${bookingTimeStr}
ğŸ’° é ä¼°è»Šè³‡ï¼š$${fare}
(é‡Œç¨‹ ${km}km / æ™‚é–“ ${mins}åˆ†)
----------------
ğŸ‘¥ ä¹˜å®¢ï¼š${pax}äºº
ğŸ§³ è¡Œæï¼š${lugText}
ğŸ¶ å¯µç‰©ï¼š${petText}
âš ï¸ é‡è¦å‚™è¨»ï¼šè«‹å…ˆåŒ¯æ¬¾ä»¥ä¿ç•™è»Šè¼›`;

                document.getElementById('addFriendLink').href = `https://line.me/ti/p/~${MY_LINE_ID}`;
                document.getElementById('lineLink').href = `https://line.me/R/msg/text/?${encodeURIComponent(lineMsg)}`;

            } catch(e) { alert("è¨ˆç®—å¤±æ•—ï¼Œè«‹æª¢æŸ¥åœ°å€æ˜¯å¦æ­£ç¢º"); console.log(e); }
        }

        // ================= é›·é”é‚è¼¯ (ä¿æŒä¸è®Š) =================
        const timeSelect = document.getElementById('radarTimeSelect');
        const nowHour = new Date().getHours();
        for(let i=0; i<24; i++) {
            let opt = document.createElement('option');
            opt.value = i;
            opt.text = `${i}:00 æ™‚æ®µ ${i===nowHour ? '(ç¾åœ¨)' : ''}`;
            if(i===nowHour) opt.selected = true;
            timeSelect.add(opt);
        }

        function toggleAddPanel() {
            const p = document.getElementById('addPanel');
            p.style.display = p.style.display === 'none' ? 'block' : 'none';
        }

        async function findHotspots() {
            const input = document.getElementById('radarInput').value;
            const targetTime = parseInt(document.getElementById('radarTimeSelect').value);
            const div = document.getElementById('radarResults');
            div.innerHTML = "<div style='text-align:center; color:#666;'>æƒæä¸­...</div>";
            let uLat, uLon;
            try {
                if(currentLat && (!input || input === "ğŸ“ ç›®å‰ä½ç½®")) {
                    uLat = currentLat; uLon = currentLon;
                } else {
                    if(!input) { div.innerHTML = "è«‹è¼¸å…¥ä½ç½®æˆ–æŒ‰ GPS"; return; }
                    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${input}&limit=1`);
                    const data = await res.json();
                    if(!data.length) throw new Error();
                    uLat = data[0].lat; uLon = data[0].lon;
                }
                let results = myHotspots.map((spot, idx) => {
                    const dist = calcDist(uLat, uLon, spot.lat, spot.lon);
                    const isHot = (spot.hours || []).includes(targetTime);
                    const score = (spot.price / (dist + 1)) * (isHot ? 1.5 : 0.5);
                    return { ...spot, dist, score, isHot, id: idx };
                });
                results.sort((a,b) => b.score - a.score);
                div.innerHTML = "";
                if(results.length === 0) div.innerHTML = "ç„¡è³‡æ–™";
                results.slice(0, 10).forEach(spot => {
                    const hotClass = spot.isHot ? 'hot' : '';
                    div.innerHTML += `
                        <div class="card ${hotClass}">
                            <div class="card-header">
                                <span class="card-title">${spot.name}</span>
                                <div><span class="badge badge-price">$${spot.price}</span><span class="badge badge-dist">${spot.dist.toFixed(1)}km</span></div>
                            </div>
                            <div style="color:#888; font-size:13px;">${spot.note}</div>
                            ${spot.isHot ? '<div style="color:#ff3d00; font-size:12px; margin-top:5px;">ğŸ”¥ ç†±é–€æ™‚æ®µ</div>' : ''}
                            <a href="https://www.google.com/maps/dir/?api=1&destination=${spot.lat},${spot.lon}" target="_blank" class="nav-link">ğŸš€ å°èˆª</a>
                            <div style="text-align:right; margin-top:5px; font-size:12px; color:#666; cursor:pointer;" onclick="delSpot(${spot.id})">åˆªé™¤</div>
                        </div>`;
                });
            } catch(e) { div.innerHTML = "æ‰¾ä¸åˆ°è©²åœ°é»"; }
        }

        function useGPS() {
            if(!navigator.geolocation) return alert("ä¸æ”¯æ´ GPS");
            navigator.geolocation.getCurrentPosition(p => {
                currentLat = p.coords.latitude;
                currentLon = p.coords.longitude;
                document.getElementById('radarInput').value = "ğŸ“ ç›®å‰ä½ç½®";
                findHotspots();
            }, () => alert("GPS å¤±æ•—"));
        }

        async function addSpot() {
            const name = document.getElementById('newName').value;
            const price = document.getElementById('newPrice').value;
            const note = document.getElementById('newNote').value;
            const hoursStr = document.getElementById('newHours').value;
            if(!name || !price) return alert("è³‡æ–™ä¸å®Œæ•´");
            const hours = hoursStr ? hoursStr.split(',').map(Number) : Array.from({length:24},(_,i)=>i);
            let lat = currentLat, lon = currentLon;
            if(!lat) {
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${name}&limit=1`);
                const data = await res.json();
                if(data.length) { lat = data[0].lat; lon = data[0].lon; }
                else return alert("æŠ“ä¸åˆ°åº§æ¨™ï¼Œè«‹å…ˆé–‹å•Ÿ GPS å®šä½");
            }
            myHotspots.push({ name, price, note, hours, lat, lon });
            localStorage.setItem('uberDriverData', JSON.stringify(myHotspots));
            alert("å·²å„²å­˜");
            toggleAddPanel();
            findHotspots();
        }

        function delSpot(idx) {
            if(confirm("åˆªé™¤æ­¤é»ï¼Ÿ")) {
                myHotspots.splice(idx, 1);
                localStorage.setItem('uberDriverData', JSON.stringify(myHotspots));
                findHotspots();
            }
        }

        function calcDist(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = (lat2-lat1)*Math.PI/180;
            const dLon = (lon2-lon1)*Math.PI/180;
            const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        switchTab('radar'); 
    </script>
</body>
</html>
